¬°Perfecto! Aqu√≠ tienes el **c√≥digo completo en R Markdown (`.Rmd`)** listo para copiar y pegar en un archivo `.Rmd` en RStudio. Este reporte generar√° autom√°ticamente:

‚úÖ Tabla de percentiles  
‚úÖ Gr√°fico de evoluci√≥n diaria con umbrales  
‚úÖ Explicaci√≥n t√©cnica  
‚úÖ Justificaci√≥n del umbral  
‚úÖ Listo para exportar a PDF o HTML (ideal para SBS o jefes)

---

## üìÑ C√≥digo R Markdown ‚Äî Reporte T√©cnico de Umbral Estad√≠stico

```r
---
title: "Reporte T√©cnico: Umbral Estad√≠stico para % de Diferencias en Transacciones"
author: "Tu Nombre / √Årea de Estad√≠stica"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    highlight: tango
    fig_caption: true
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(dplyr)
library(scales)
```

## 1. Introducci√≥n

Este reporte tiene como objetivo justificar estad√≠sticamente el nuevo umbral para el **porcentaje de diferencias** entre las transacciones enviadas por UNIBANCA (UBA) y las recibidas por nuestro sistema (SBP), reemplazando el umbral arbitrario de **0.05%** establecido previamente sin base t√©cnica.

El an√°lisis se basa en **174 d√≠as de operaci√≥n** desde el **01/04/2025 hasta el 21/09/2025**.

## 2. Metodolog√≠a

Se utiliz√≥ el m√©todo de **percentiles emp√≠ricos no param√©tricos** sobre la variable:

\[
\text{\% Diferencia} = \frac{\text{Txns UBA} - \text{Txns SBP}}{\text{Txns UBA}}
\]

Este m√©todo es robusto, no asume normalidad, y es ampliamente aceptado en entornos financieros regulados.

## 3. C√°lculo de Percentiles

Los percentiles fueron calculados con la funci√≥n `quantile()` en R, que ordena autom√°ticamente los datos.

```{r}
# --- SIMULACI√ìN DE DATOS (reemplaza esto con tus datos reales) ---
set.seed(123)
# Tus datos reales deben cargarse aqu√≠, por ejemplo:
# pct_diff <- read.csv("tus_datos.csv")$pct_diff
# Para este ejemplo, simulamos datos similares a los tuyos
pct_diff <- c(
  rnorm(130, mean = 0.015, sd = 0.03),  # mayor√≠a alrededor de 1-2%
  runif(30, 0.15, 0.50),                # algunos d√≠as altos
  runif(14, 0.50, 0.70)                 # outliers extremos
)

# Calcular percentiles clave
percentiles <- quantile(pct_diff, probs = c(0.01, 0.025, 0.05, 0.10, 0.25, 0.50, 0.75, 0.90, 0.95, 0.975, 0.99))
percentiles_df <- data.frame(
  Percentil = names(percentiles),
  Valor = as.numeric(percentiles),
  Valor_Porcentaje = scales::percent(percentiles, accuracy = 0.01)
)
percentiles_df
```

## 4. Interpretaci√≥n de Percentiles Clave

- **P75 = `r scales::percent(percentiles["75%"], accuracy = 0.01)`**: El 75% de los d√≠as tienen diferencias menores a este valor. Se us√≥ como base para definir el umbral operativo de **+5%**.
- **P95 = `r scales::percent(percentiles["95%"], accuracy = 0.01)`**: Solo el 5% de los d√≠as superan este valor. Se define como **umbral cr√≠tico**.

## 5. Gr√°fico de Evoluci√≥n Diaria

```{r}
# Crear data frame con fechas simuladas (reemplaza con tus fechas reales)
fecha_inicio <- as.Date("2025-04-01")
fecha_fin <- as.Date("2025-09-21")
fechas <- seq(fecha_inicio, fecha_fin, by = "day")[1:length(pct_diff)]

df <- data.frame(fecha = fechas, pct_diff = pct_diff)

# Definir umbrales
umbral_revision <- 0.05      # +5%
umbral_critico <- percentiles["95%"]  # P95%

# Crear columna de alerta
df$alerta <- ifelse(df$pct_diff > umbral_critico, "Cr√≠tica", "Normal")

# Gr√°fico
grafico <- ggplot(df, aes(x = fecha, y = pct_diff)) +
  geom_line(data = subset(df, alerta == "Normal"), 
            color = "#00BFC4", size = 1) +
  geom_point(data = subset(df, alerta == "Normal"),
             color = "#00BFC4", size = 1.5, shape = 16) +
  geom_point(data = subset(df, alerta == "Cr√≠tica"),
             color = "red", size = 3, shape = 17) +
  geom_hline(yintercept = umbral_revision, 
             color = "orange", linetype = "dashed", size = 1) +
  geom_hline(yintercept = umbral_critico, 
             color = "red", linetype = "dashed", size = 1) +
  annotate("text", x = min(df$fecha), y = umbral_revision, 
           label = "+5% (Revisi√≥n)", 
           color = "orange", hjust = 0, vjust = 0.5, size = 3) +
  annotate("text", x = min(df$fecha), y = umbral_critico, 
           label = paste0("+", scales::percent(umbral_critico, accuracy = 0.01), " (Alerta Cr√≠tica)"), 
           color = "red", hjust = 0, vjust = 0.5, size = 3) +
  labs(
    title = "Evoluci√≥n Diaria del % de Diferencias",
    subtitle = "Periodo: 01/04/2025 ‚Äì 21/09/2025",
    x = "Fecha",
    y = "% Diferencia (UBA - SBP) / UBA"
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 0.1)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 10),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.text.y = element_text(size = 10),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank()
  )

grafico
```

## 6. Definici√≥n de Umbrales

| Nivel | Umbral | Base Estad√≠stica | Acci√≥n |
|------|--------|------------------|--------|
| üî¥ **Cr√≠tica** | > `r scales::percent(umbral_critico, accuracy = 0.01)` | Percentil 95% | Revisi√≥n urgente, reporte formal |
| üü° **Revisi√≥n** | > +5% y ‚â§ `r scales::percent(umbral_critico, accuracy = 0.01)` | Basado en P75 (`r scales::percent(percentiles["75%"], accuracy = 0.01)`) | Revisi√≥n manual |
| üü¢ **Normal** | ‚â§ +5% | Operativo | Sin acci√≥n |

## 7. Justificaci√≥n vs. Umbral Anterior (0.05%)

El umbral anterior de **0.05%** era arbitrario y generaba falsos positivos innecesarios. El nuevo enfoque:

- ‚úÖ Reduce falsos positivos.
- ‚úÖ Se basa en el comportamiento real del sistema.
- ‚úÖ Es auditado y defensible ante la SBS.
- ‚úÖ Clasifica riesgos en niveles (normal, revisi√≥n, cr√≠tica).

## 8. Conclusi√≥n

El umbral de **`r scales::percent(umbral_critico, accuracy = 0.01)`** corresponde al **percentil 95%** del historial, lo que significa que solo el **5% de los d√≠as** han tenido diferencias tan altas. Este m√©todo es **robusto, no param√©trico y completamente sustentable** ante auditor√≠as regulatorias.

Se recomienda implementar este nuevo criterio como parte del control de calidad diario de las transacciones.

## 9. Anexos

### C√≥digo R utilizado

```{r, echo=TRUE, eval=FALSE}
# Cargar datos
# pct_diff <- read.csv("tus_datos.csv")$pct_diff

# Calcular percentiles
quantile(pct_diff, probs = c(0.01, 0.025, 0.05, 0.10, 0.25, 0.50, 0.75, 0.90, 0.95, 0.975, 0.99))

# Gr√°fico
# ... (c√≥digo del gr√°fico)
```

### Frecuencia de Revisi√≥n

El umbral se revisar√° **trimestralmente**, utilizando una ventana m√≥vil de 180 d√≠as.
```

---

## üõ†Ô∏è INSTRUCCIONES PARA USARLO

1. Abre **RStudio**.
2. Ve a `File > New File > R Markdown`.
3. Copia y pega todo el c√≥digo anterior.
4. **Reemplaza la simulaci√≥n de datos** por tus datos reales:

```r
# En lugar de:
pct_diff <- c( ... )  # simulaci√≥n

# Usa:
pct_diff <- read.csv("ruta/tu_archivo.csv")$nombre_columna_pct_diff
```

5. Haz clic en **‚ÄúKnit‚Äù** ‚Üí selecciona PDF o HTML.
6. ¬°Listo! Tendr√°s un reporte profesional, autom√°tico y auditado.

---

## ‚úÖ BENEFICIOS

- ‚úÖ **Autom√°tico**: cada vez que actualices tus datos, solo das ‚ÄúKnit‚Äù.
- ‚úÖ **Auditado**: todo el c√≥digo y c√°lculos son transparentes.
- ‚úÖ **Profesional**: formato listo para presentar a jefes o SBS.
- ‚úÖ **Flexible**: puedes modificar umbrales, colores, t√≠tulos f√°cilmente.

---

¬øQuieres que te genere tambi√©n una **versi√≥n en Word o PDF precompilada**?  
¬øO que a√±ada una **tabla de d√≠as cr√≠ticos** con fechas y valores?  
¬°Solo dime y lo agrego! üìäüìÑ

Este reporte es **tu documento oficial de justificaci√≥n t√©cnica** ‚Äî s√≥lido, claro y profesional.